function initMapPopovers() {
  document.querySelectorAll('.location-link-wrapper').forEach(wrapper => {
    const popover = wrapper.querySelector('.map-popover');
    if (!popover) return;

    const showPopover = () => {
      const locationLink = wrapper.querySelector('.location-link');
      const link = locationLink || wrapper.querySelector('a');
      if (!link) return;

      const linkRect = link.getBoundingClientRect();
      const popoverWidth = 70;
      const popoverHeight = 70;

      let left = linkRect.right + 8;
      if (left + popoverWidth > window.innerWidth - 8) {
        left = window.innerWidth - popoverWidth - 8;
      }

      const player = document.getElementById('audio-player');
      let top;
      if (player) {
        const playerRect = player.getBoundingClientRect();
        top = playerRect.top + (playerRect.height - popoverHeight) / 2;
      } else {
        top = linkRect.top + linkRect.height / 2 - popoverHeight / 2;
      }

      popover.style.left = left + 'px';
      popover.style.top = top + 'px';
      popover.classList.add('visible');
    };

    const hidePopover = () => {
      popover.classList.remove('visible');
    };

    wrapper.querySelectorAll('a').forEach(link => {
      link.addEventListener('mouseenter', showPopover);
      link.addEventListener('mouseleave', hidePopover);
    });
  });
}

